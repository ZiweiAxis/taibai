# P1：协议与文档与根技术方案 §4 一致

**来源**：根《各子项目应对焦事项与进度同步》§2.3 太白 P1。  
**执行**：由**太白 sub-agent** 在 `ziwei/taibai` 下按 **BMAD** 规划与实现。

---

## 目标

保持 **SDK**、**verification_agent**、**docs** 与根协议定义一致。

## 权威依据

- **技术方案 §4**：`ziwei/docs/open/technical/紫微智能体治理基础设施-技术方案.md` 第 4 节「太白子系统：开放接入规范」
  - 4.2 太白协议（事件类型：`m.agent.register_request`、`m.agent.identity`、`m.agent.action`、`m.agent.audit`、`m.agent.heartbeat`、`m.agent.revoke`）
  - 4.3 太白 SDK（注册与身份续期、操作打点与上报、环境指纹、心跳、策略查询）
  - 4.4 预置适配器

## 建议动作

1. 对照技术方案 §4，逐项核对 `sdk/python/`、`docs/协议与SDK说明.md`、`examples/verification_agent/` 与根协议是否一致。
2. 若有偏差，在 `_bmad-output/` 下记录偏差与对齐方案，再修改代码或文档。
3. 更新本仓 README、`docs/` 中引用路径为 `ziwei/docs/open/technical/...`（若尚未统一）。

## 验收

- SDK 与 verification_agent 行为、事件类型与载荷与技术方案 §4 描述一致；文档无矛盾。

---

## 对齐结果（2026-02-15）

| 项 | §4 约定 | 本仓现状 | 状态 |
|----|---------|----------|------|
| 事件类型 | m.agent.register_request / identity / action / audit / heartbeat / revoke | protocol.py 常量与 §4.2 表一致 | ✓ 一致 |
| SDK 注册/心跳/上报 | 自动注册与身份续期、心跳维护、操作打点与上报 | agent.py：register、heartbeat、trace；当前经 HTTP 调天枢/谛听 | ✓ 一致（实现路径 HTTP 先行） |
| 环境指纹 | 环境指纹采集 | 未实现 | 规划中 |
| 策略决策点查询 | 当前操作是否需要审批 | 未实现 | 规划中 |
| 示例参数名 | §4.3 示例为 matrix_server | Agent 使用 tianshu_api_base（与天枢 HTTP API 对应） | ✓ 文档已说明等价关系 |
| docs 示例 | trace 用法 | 已修正：trace(action_type, **detail)，示例用 ACTION_FILE_WRITE | ✓ 已修正 |

**结论**：事件类型与核心能力（发现、注册、心跳、操作上报）与 §4 一致；环境指纹、策略查询为后续增强。引用路径已统一为 `ziwei/docs/open/technical/...`。
